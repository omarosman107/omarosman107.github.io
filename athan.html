<!DOCTYPE html>
<html lang="en">
<head>
	<title>Athan Times</title>
	   <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">

<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

	<style type="text/css"> 
	@import url("https://fonts.googleapis.com/css?family=Quicksand:500");
	@import url("https://fonts.googleapis.com/css?family=Montserrat:400,900");
.main {
width: 90%;
background: white;
margin: auto;
margin-top: 70px;
box-shadow: rgb(197, 204, 212) 0px 2px 20px 0px;
margin-bottom: 40px;

}
body{
	    background: #f4f4f4;
	    margin: 0;
	    color: white;
	        text-transform: uppercase;


}
.top {
	background: black;
	height: 75%;
	margin: auto;
	font-size: 11em;
	text-align: center;
	background:url(https://images.unsplash.com/40/whtXWmDGTTuddi1ncK5v_IMG_0097.jpg?dpr=1&auto=format&fm=png&fit=crop&w=1920&h=1080&q=40&cs=tinysrgb&crop=&bg=);
	    background-size: cover;
	    font-family: Ostrich Sans Inline;
}
.static {
	content: "";
	    position: absolute;
    width: 100%;
    height: 100%;
       background-repeat: no-repeat;
    background-attachment: fixed; 
    opacity: 1;
    z-index: 15;
    -webkit-transform: translateZ(0px);
    transform: translateZ(0px);
    -webkit-transition: -webkit-transform 0.4s;
    transition: -webkit-transform 0.4s;
    transition: transform 0.4s;
    transition: transform 0.4s, -webkit-transform 0.4s;
    border: none;
}
.prayers {
	    font-size: 18px;
	display: inline-block;
	width: 19%;
    color: #787878;
            text-align: center;
    font-family: Quicksand;
    font-weight: 600;
}
.prayers span{
			font-size: 4vw;
	        display: block;
	        font-family: Montserrat;
	        font-weight: normal;
	            color: #565656;

}
.prayers span.ampm {
    display: inline-block;
    font-size: 3vw;
}
.times{
    padding: 35px;
}

.overlay {
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
        z-index: 2;
    background: url(http://i.imgur.com/P0Kkvuv.png);
       background-repeat: no-repeat;
    background-attachment: fixed; 
	}
	#left{
		position: relative;
    bottom: -80px;
    font-weight: 700;
    font-size: 2em;
        left: 20px;

	}

	@media (max-width: 1000px ){
#left {
	    position: relative;
    bottom: -80px;
    font-weight: 700;
    font-size: 30vw;
    left: 20px;

}


	}
	@media  (max-width: 550px){
		.prayers {
	    font-size: 20px;
	display: inline-block;
	width: 100%;
    color: #787878;
            text-align: center;
    font-family: Quicksand;
    font-weight: 600;
}
.prayers span{
			font-size: 19vw;
	        display: block;
	        font-family: Ostrich Sans Rounded;
	        font-weight: bolder;
	            color: #565656;

}
.prayers span.ampm {
    display: inline-block;
    font-size: 9vw;
}

	}
	#until {
		font-size: 40px;
    
    color: rgba(255, 255, 255, 0.49);
	}
	@media (min-width: 2000px ){
#left {
    position: relative;
    bottom: 0px; 
    font-weight: 700;
    font-size: 24vw;
    left: 20px;
}

#until {
    font-size: 4vw;
    color: rgba(255, 255, 255, 0.49);
    position: relative;
	}

	</style>


<link async rel="stylesheet" type="text/css" href="fonts/font.css">
</head>
<body>
<div class="main">
	<div style="height: 4px;
    background: lightgreen;
    width: 0%;
 	-webkit-transition: width 500ms ease-out,opacity 500ms linear;
    transition: width 500ms ease-out,opacity 500ms linear;" id="prog"></div>
	<div class="top">
	<div class="overlay">

<i onclick="city()" style="
    position: relative;
    font-size: -webkit-xxx-large;
    padding: 15px;
    float: right;
    cursor: pointer;
    " class="material-icons">my_location</i>

	<div id="currentTime" style="
    position: absolute;
    font-size: -webkit-xxx-large;
    font-family: Ostrich Sans;
    padding: 15px;
"></div>
<div style="
    max-height: 100%;
    padding: 17px;
" class="timerContainer">
	<span id="left"></span>
    <br>
    <span id="until" style="">Until iftar</span>
    </div>
</div>
	</div>
	<div class="times">
		<div class="prayers">Fajr<span id="fajr"></span></div>
		<div class="prayers">Dhuhr<span id="duhur"></span></div>
		<div class="prayers">Asr<span id="asr"></span></div>
		<div class="prayers">Maghrib<span id="maghrib"></span></div>
		<div class="prayers">Isha<span id="isha"></span></div>

	</div>
</div>
<script type="text/javascript">
function city() {
    var txt;
    var place = prompt("Please enter your location:", "");
    if (place == null || place == "") {
return;
    } else {
        txt = place;
    }
    prayers(place)

}

  // At first, let's check if we have permission for notification
  // If not, let's ask for it
  if (window.Notification && Notification.permission !== "granted") {
    Notification.requestPermission(function (status) {
      if (Notification.permission !== status) {
        Notification.permission = status;
      }
    });
  }


    // If the user agreed to get notified
    // Let's try to send ten notifications
    if (window.Notification && Notification.permission === "granted") {
      var i = 0;
      // Using an interval cause some browsers (including Firefox) are blocking notifications if there are too much in a certain time.

    }

    // If the user hasn't told if he wants to be notified or not
    // Note: because of Chrome, we are not sure the permission property
    // is set, therefore it's unsafe to check for the "default" value.
    else if (window.Notification && Notification.permission !== "denied") {
      Notification.requestPermission(function (status) {
        // If the user said okay
        if (status === "granted") {
          var i = 0;
          // Using an interval cause some browsers (including Firefox) are blocking notifications if there are too much in a certain time.

        }

        // Otherwise, we can fallback to a regular modal alert
        else {
        }
      });
    }

    // If the user refuses to get notified
    else {
      // We can fallback to a regular modal alert
    }
    var notified = false
var done = false
function notif(a){
if (a == 'done' && !done) {
            var n = new Notification("It's Iftar now! ", {tag: 'soManyNotification'});

done = true
}
if (a == 'notify' && !notified) {
            var n = new Notification("it's almost iftar! " , {tag: 'soManyNotification'});

notified = true
}

}


function getTimeRemaining(endtime){
  var t = Date.parse(endtime) - Date.parse(new Date());
  var seconds = Math.floor( (t/1000) % 60 );
  var minutes = Math.floor( (t/1000/60) % 60 );
  var hours = Math.floor( (t/(1000*60*60)) % 24 );
  var days = Math.floor( t/(1000*60*60*24) );
  return {
    'total': t,
    'days': days,
    'hours': hours,
    'minutes': minutes,
    'seconds': seconds
  };
}

var xml = new XMLHttpRequest();
xml.onreadystatechange = function(){
	if (this.readyState == 4 && this.status == 200) {
    	var data = (this.responseText)
    	data = data.replace(/<img /gi, "<my_img ").replace(/<\/img>/gi, "</my_img>");
    	doc = document.createElement('body')
    	doc.innerHTML = data
    	var whenstart = new Date(doc.querySelectorAll('.vk_ans')[0].querySelectorAll('div')[1].innerHTML + ' '+new Date().getFullYear())

var whenend = new Date(doc.querySelectorAll('.vk_ans')[1].querySelectorAll('div')[1].innerHTML + ' '+new Date().getFullYear())
whenend.setTime( whenend.getTime() + 2 * 86400000 );
whenstart.setTime( whenstart.getTime() + 1 * 86400000 );
 var  today = new Date() 
    var p = (((today - whenstart) / (whenend - whenstart)) * 100) + '%';


    	document.getElementById('currentTime').innerHTML = getTimeRemaining(whenend).days + " days left"
	document.getElementById('prog').style.width = (((today - whenstart) / (whenend - whenstart)) * 100) + '%';
setInterval(function(){
	 var  today = new Date() 

	document.getElementById('prog').style.width = (((today - whenstart) / (whenend - whenstart)) * 100) + '%';
    	document.getElementById('currentTime').innerHTML = getTimeRemaining(whenend).days + " days left"

},3000)

	}
}
  xml.open("GET", 'https://cors-anywhere.herokuapp.com/https://www.google.com/search?q=ramadan+' + new Date().getFullYear(), true);
  xml.send();



	var timer

function prayers(place){
            clearInterval(timer);

loc = new XMLHttpRequest();
loc.onreadystatechange = function(){
	if (this.readyState == 4 && this.status == 200) {
		var data = JSON.parse(this.responseText).results[0]
			document.getElementById('until').innerHTML = (data.formatted_address) +' - left until iftar' 
		console.log(data.geometry.location.lat,data.geometry.location.lng)
 		var url = 'http://api.aladhan.com/timings?latitude='+data.geometry.location.lat+'5&longitude='+data.geometry.location.lng+'&timezonestring='+Intl.DateTimeFormat().resolvedOptions().timeZone
+'&method=2'
		  xhttp.open("GET", url, true);
  xhttp.send();


		for (var i = data.address_components.length - 1; i >= 0; i--) {
			console.log(data.address_components[i])
			 if (data.address_components[i].types[0] == "locality"){ 
        console.log(data.address_components[i].long_name); 
       
	
        return false; 
    }
		}


	}
}
  loc.open("GET", 'https://maps.googleapis.com/maps/api/geocode/json?address='+ place, true);
  loc.send();


  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
    	var data = JSON.parse(this.responseText)
  	var fajr = new Date(data.data.timings.Fajr +" "+data.data.date.readable)
  	var duhur = new Date(data.data.timings.Dhuhr +" "+data.data.date.readable)
  	var asr = new Date(data.data.timings.Asr +" "+data.data.date.readable)
  	var maghrib = new Date(data.data.timings.Maghrib +" "+data.data.date.readable)
  	var isha = new Date(data.data.timings.Isha +" "+data.data.date.readable)
function formatAMPM(date) {
  var hours = date.getHours();
  var minutes = date.getMinutes();
  var ampm = hours >= 12 ? 'pm' : 'am';
  hours = hours % 12;
  hours = hours ? hours : 12; // the hour '0' should be '12'
  minutes = minutes < 10 ? '0'+minutes : minutes;
  var strTime = hours + ':' + minutes + ' ' + '<span class="ampm">'+ampm+'</span>';
  return strTime;
}

    	document.getElementById('fajr').innerHTML = formatAMPM(fajr)
    	    	document.getElementById('duhur').innerHTML = formatAMPM(duhur);
    	    	    	document.getElementById('asr').innerHTML = formatAMPM(asr)
    	    	    	    	document.getElementById('maghrib').innerHTML = formatAMPM(maghrib);
    	    	    	    	    	document.getElementById('isha').innerHTML = formatAMPM(isha);

var end = maghrib

    var _second = 1000;
    var _minute = _second * 60;
    var _hour = _minute * 60;
    var _day = _hour * 24;

    function showRemaining() {


        var now = new Date();
        var distance = end - now;
        if (distance < 0) {

            clearInterval(timer);
            document.getElementById('left').innerHTML = 'Eat';
                        document.getElementById('until').innerHTML = 'Until Fajr!';

notif('done')
            return;
        }
        if (distance < 600000) {
        	notif('notify')
        }
/*
        var days = Math.floor(distance / _day);
        var hours = Math.floor((distance % _day) / _hour);
        var minutes = Math.floor((distance % _hour) / _minute);
        var seconds = Math.floor((distance % _minute) / _second);

        if (hours < 10) {
        	hours = '0' + hours
        }
           if (minutes < 10) {
        	minutes = '0' + minutes
        }
           if (seconds < 10) {
        	seconds = '0' + seconds
        }
*/

var time = getTimeRemaining(end)
   if (time.hours < 10) {
        	time.hours = '0' + time.hours
        }
           if (time.minutes < 10) {
        	time.minutes = '0' + time.minutes
        }
           if (time.seconds < 10) {
        	time.seconds = '0' + time.seconds
        }

        document.getElementById('left').innerHTML = time.hours + ":" + time.minutes + ':' + time.seconds

    }
showRemaining()
    timer = setInterval(showRemaining, 1000);






    }
  };

}

var ip = new XMLHttpRequest();
ip.onreadystatechange = function(){
		if (this.readyState == 4 && this.status == 200) {
var ipdata = JSON.parse(this.responseText)
prayers(ipdata.city + ' , ' + ipdata.region_name +' '+ ipdata.country_name)
}
}
ip.open("GET",'https://freegeoip.net/json/',true);
ip.send();
</script>
</body>
</html> 